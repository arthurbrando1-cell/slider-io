<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Slider.io</title>

<style>
  body {
    margin: 0;
    background: #0f0f14;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }

  canvas {
    display: block;
    margin: auto;
    background: #111;
  }
</style>
</head>

<body>
<canvas id="game" width="800" height="500"></canvas>

<script type="module">
/* ================= FIREBASE (SEM NPM) ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getDatabase,
  ref,
  set,
  onValue,
  remove
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCfdgkO3WzaxXT-djAA6MsLC2m26c9optU",
  authDomain: "slider-io.firebaseapp.com",
  databaseURL: "https://slider-io-default-rtdb.firebaseio.com",
  projectId: "slider-io",
  storageBucket: "slider-io.firebasestorage.app",
  messagingSenderId: "395647141464",
  appId: "1:395647141464:web:251cc58a3e0e90ca262c2d"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= GAME ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const playerId = Math.random().toString(36).slice(2);
let players = {};

let me = {
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  size: 12
};

/* SALVA PLAYER */
const myRef = ref(db, "players/" + playerId);
set(myRef, me);

window.addEventListener("beforeunload", () => {
  remove(myRef);
});

/* RECEBE PLAYERS */
onValue(ref(db, "players"), snap => {
  players = snap.val() || {};
});

/* CONTROLES */
let keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function update() {
  const speed = 3;
  if (keys["w"]) me.y -= speed;
  if (keys["s"]) me.y += speed;
  if (keys["a"]) me.x -= speed;
  if (keys["d"]) me.x += speed;

  set(myRef, me);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let id in players) {
    const p = players[id];
    if (!p) continue;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fillStyle = id === playerId ? "#4ade80" : "#60a5fa";
    ctx.fill();
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
