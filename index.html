<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sliterz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0; padding:0; overflow:hidden;
  background:#08080f; font-family:Arial,sans-serif;
}
canvas{display:block}

button,input{outline:none}

#lobby{
  position:fixed; inset:0;
  background:linear-gradient(180deg,#0a0a15,#020205);
  color:white; z-index:20;
  display:flex; align-items:center; justify-content:center;
}
.panel{
  width:720px; max-width:95%;
  background:#141425;
  border-radius:18px; padding:25px;
}
.tabs button{
  margin:5px; padding:8px 14px;
  background:#222; color:white; border:none;
}
.tab{display:none}
.tab.active{display:block}

#hud{
  position:fixed; top:10px; left:10px;
  color:white; z-index:5;
  transform-origin:top left;
}

#boostBtn{
  position:fixed; right:20px; bottom:80px;
  width:70px; height:70px; border-radius:50%;
  background:#ff595e; color:white;
  border:none; font-weight:bold;
}
</style>
</head>

<body>

<!-- ===== LOBBY ===== -->
<div id="lobby">
  <div class="panel">
    <h1>üêç SLITERZ</h1>

    <div class="tabs">
      <button onclick="openTab('play')">Jogar</button>
      <button onclick="openTab('shop')">Loja</button>
      <button onclick="openTab('rank')">Ranking</button>
      <button onclick="openTab('settings')">Config</button>
    </div>

    <div id="play" class="tab active">
      <p>Nick:</p>
      <input id="nick" placeholder="Player"><br><br>
      <button onclick="start()">‚ñ∂ Jogar</button>
    </div>

    <div id="shop" class="tab">
      <h3>üõí Loja</h3>
      <button>+ Velocidade (100)</button><br><br>
      <button>Boost melhor (150)</button><br><br>
      <small>(funciona na pr√≥xima etapa)</small>
    </div>

    <div id="rank" class="tab">
      <h3>üèÜ Ranking Global</h3>
      <ol id="rankList"></ol>
    </div>

    <div id="settings" class="tab">
      <h3>‚öôÔ∏è Configura√ß√µes</h3>
      <label>
        <input type="checkbox" id="noBg">
        Esconder fundo
      </label><br><br>

      <label>Zoom c√¢mera</label><br>
      <input type="range" min="1" max="2" step="0.1" value="1.3"
        oninput="camZoom=this.value"><br><br>

      <label>HUD escala</label><br>
      <input type="range" min="0.5" max="2" step="0.1" value="1"
        oninput="hudScale=this.value">
    </div>
  </div>
</div>

<div id="hud">Score: 0</div>
<button id="boostBtn">BOOST</button>
<canvas id="game"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, set, onValue, remove, onDisconnect, update
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCfdgkO3WzaxXT-djAA6MsLC2m26c9optU",
  authDomain: "slider-io.firebaseapp.com",
  databaseURL: "https://slider-io-default-rtdb.firebaseio.com",
  projectId: "slider-io",
  storageBucket: "slider-io.firebasestorage.app",
  messagingSenderId: "395647141464",
  appId: "1:395647141464:web:251cc58a3e0e90ca262c2d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* CANVAS */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
resize(); addEventListener("resize",resize);
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}

/* VARS */
let id, me, players={}, foods={}
let mouse={x:0,y:0}
let boost=false
window.camZoom=1.3
window.hudScale=1

/* INPUT */
addEventListener("mousemove",e=>{
  mouse.x=e.clientX-canvas.width/2
  mouse.y=e.clientY-canvas.height/2
})
addEventListener("keydown",e=>{if(e.key==="c")boost=true})
addEventListener("keyup",e=>{if(e.key==="c")boost=false})
boostBtn.ontouchstart=()=>boost=true
boostBtn.ontouchend=()=>boost=false

/* LOBBY */
window.openTab=t=>{
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"))
  document.getElementById(t).classList.add("active")
}

/* START */
window.start=()=>{
  document.getElementById("lobby").style.display="none"
  id=Math.random().toString(36).slice(2)
  me={
    nick:nick.value||"Player",
    snake:Array.from({length:12},(_,i)=>({x:-i*8,y:0})),
    score:0
  }
  const myRef=ref(db,"players/"+id)
  set(myRef,me)
  onDisconnect(myRef).remove()

  onValue(ref(db,"players"),s=>players=s.val()||{})
  onValue(ref(db,"foods"),s=>foods=s.val()||{})

  onValue(ref(db,"players"),snap=>{
    const arr=Object.values(snap.val()||{})
      .sort((a,b)=>b.score-a.score)
      .slice(0,10)
    rankList.innerHTML=arr.map(p=>`<li>${p.nick} - ${p.score}</li>`).join("")
  })

  loop()
}

/* FOOD SPAWN */
setInterval(()=>{
  if(Object.keys(foods).length<1000){
    const fid=Math.random().toString(36).slice(2)
    set(ref(db,"foods/"+fid),{
      x:Math.random()*6000-3000,
      y:Math.random()*6000-3000
    })
  }
},300)

/* UPDATE */
function updateGame(){
  if(!me)return
  const head=me.snake[0]
  const d=Math.hypot(mouse.x,mouse.y)||1
  const sp=boost?5:2.8

  me.snake.unshift({
    x:head.x+mouse.x/d*sp,
    y:head.y+mouse.y/d*sp
  })

  let ate=false
  for(const f in foods){
    const fd=foods[f]
    if(Math.hypot(head.x-fd.x,head.y-fd.y)<7){
      ate=true
      me.score++
      remove(ref(db,"foods/"+f))
      break
    }
  }
  if(!ate||boost)me.snake.pop()

  hud.style.transform=`scale(${hudScale})`
  hud.innerText="Score: "+me.score
  update(ref(db,"players/"+id),me)
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height)
  if(!me)return

  if(!noBg.checked){
    ctx.fillStyle="#0e0e18"
    ctx.fillRect(0,0,canvas.width,canvas.height)
  }

  ctx.save()
  ctx.translate(canvas.width/2,canvas.height/2)
  ctx.scale(camZoom,camZoom)
  ctx.translate(-me.snake[0].x,-me.snake[0].y)

  ctx.fillStyle="#ffd166"
  for(const f in foods){
    const fd=foods[f]
    ctx.beginPath();ctx.arc(fd.x,fd.y,3,0,Math.PI*2);ctx.fill()
  }

  for(const p in players){
    const pl=players[p]
    if(!pl?.snake)continue
    ctx.fillStyle=p===id?"#6a4c93":"#1982c4"
    pl.snake.forEach((s,i)=>{
      ctx.beginPath()
      ctx.arc(s.x,s.y,i?6:7,0,Math.PI*2)
      ctx.fill()
    })
  }

  ctx.restore()
}

/* LOOP */
function loop(){
  updateGame()
  draw()
  requestAnimationFrame(loop)
}
</script>
</body>
</html>
