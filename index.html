<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sliterz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#0b0b12;font-family:Arial}
canvas{display:block}
#menu{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  display:flex;align-items:center;justify-content:center;z-index:10;color:white
}
#menu .box{background:#151522;padding:25px;border-radius:14px;text-align:center}
#hud{position:fixed;top:10px;left:10px;color:white;z-index:5}
#boostBtn{
  position:fixed;right:20px;bottom:80px;
  width:70px;height:70px;border-radius:50%;
  background:#ff595e;color:white;border:none;font-weight:bold
}
</style>
</head>

<body>

<div id="menu">
  <div class="box">
    <h1>üêç SLITERZ</h1>
    <input id="nick" placeholder="Seu nick"><br><br>
    <button onclick="start()">JOGAR</button>
  </div>
</div>

<div id="hud">Score: 0</div>
<button id="boostBtn">BOOST</button>
<canvas id="game"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, set, onValue, remove, onDisconnect, update
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üî• FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCfdgkO3WzaxXT-djAA6MsLC2m26c9optU",
  authDomain: "slider-io.firebaseapp.com",
  databaseURL: "https://slider-io-default-rtdb.firebaseio.com",
  projectId: "slider-io",
  storageBucket: "slider-io.firebasestorage.app",
  messagingSenderId: "395647141464",
  appId: "1:395647141464:web:251cc58a3e0e90ca262c2d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* CANVAS */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
resize(); addEventListener("resize",resize);
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}

/* VARS */
let id, me, players={}, foods={}
let mouse={x:0,y:0}
let boost=false

addEventListener("mousemove",e=>{
  mouse.x=e.clientX-canvas.width/2
  mouse.y=e.clientY-canvas.height/2
})
addEventListener("keydown",e=>{if(e.key==="c")boost=true})
addEventListener("keyup",e=>{if(e.key==="c")boost=false})
boostBtn.ontouchstart=()=>boost=true
boostBtn.ontouchend=()=>boost=false

/* START */
window.start=()=>{
  document.getElementById("menu").style.display="none"
  id=Math.random().toString(36).slice(2)
  me={
    nick:nick.value||"Player",
    snake:Array.from({length:12},(_,i)=>({x:-i*8,y:0})),
    score:0
  }
  const myRef=ref(db,"players/"+id)
  set(myRef,me)
  onDisconnect(myRef).remove()

  onValue(ref(db,"players"),s=>players=s.val()||{})
  onValue(ref(db,"foods"),s=>foods=s.val()||{})
  loop()
}

/* FOOD SPAWN */
setInterval(()=>{
  if(Object.keys(foods).length<800){
    const fid=Math.random().toString(36).slice(2)
    set(ref(db,"foods/"+fid),{
      x:Math.random()*6000-3000,
      y:Math.random()*6000-3000
    })
  }
},300)

/* UPDATE */
function updateGame(){
  if(!me)return
  const head=me.snake[0]
  const d=Math.hypot(mouse.x,mouse.y)||1
  const sp=boost?5:2.8

  const nx=head.x+mouse.x/d*sp
  const ny=head.y+mouse.y/d*sp
  me.snake.unshift({x:nx,y:ny})

  let ate=false
  for(const f in foods){
    const fd=foods[f]
    if(Math.hypot(nx-fd.x,ny-fd.y)<7){
      ate=true
      me.score++
      remove(ref(db,"foods/"+f))
      break
    }
  }
  if(!ate||boost)me.snake.pop()

  document.getElementById("hud").innerText="Score: "+me.score
  update(ref(db,"players/"+id),me)
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height)
  if(!me)return

  ctx.save()
  ctx.translate(canvas.width/2-me.snake[0].x,canvas.height/2-me.snake[0].y)

  ctx.fillStyle="#ffd166"
  for(const f in foods){
    const fd=foods[f]
    ctx.beginPath();ctx.arc(fd.x,fd.y,3,0,Math.PI*2);ctx.fill()
  }

  for(const p in players){
    const pl=players[p]
    if(!pl||!pl.snake)continue
    ctx.fillStyle=p===id?"#6a4c93":"#1982c4"
    pl.snake.forEach((s,i)=>{
      ctx.beginPath()
      ctx.arc(s.x,s.y,i?6:7,0,Math.PI*2)
      ctx.fill()
    })
  }

  ctx.restore()
}

/* LOOP */
function loop(){
  updateGame()
  draw()
  requestAnimationFrame(loop)
}
</script>
</body>
</html>
